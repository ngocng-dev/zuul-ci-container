version: "2"

settings:
  conductor:
    base: centos:7
  project_name: ansible-networking-zuul-ci

defaults:
  ZUUL_USER: zuul
  NODEPOOL_USER: nodepool
  ZOOKEEPER_USER: zookeeper

services:
  zookeeper:
    from: "centos:7"
    roles:
      - ansible-role-zookeeper-container
    expose:
      - 2181
    user: "{{ ZOOKEEPER_USER }}"
    command: ["/usr/bin/dumb-init", "/usr/lib/zookeeper/bin/zkServer.sh", "start-foreground"]

  zuul-scheduler:
    from: "centos:7"
    roles:
      - ansible-role-zuul-common-container
      - ansible-role-zuul-scheduler-container
    expose:
      - 4730
    user: "{{ ZUUL_USER }}"
    command: ["/usr/bin/dumb-init", "/usr/bin/zuul-scheduler", "-d"]

  zuul-merger:
    from: "centos:7"
    roles:
      - ansible-role-zuul-common-container
      - ansible-role-zuul-merger-container
    user: "{{ ZUUL_USER }}"
    command: ["/usr/bin/dumb-init", "/usr/bin/zuul-merger", "-d"]

  zuul-executor:
    from: "centos:7"
    roles:
      - ansible-role-zuul-common-container
      - ansible-role-zuul-executor-container
    user: "{{ ZUUL_USER }}"
    command: ["/usr/bin/dumb-init", "/usr/bin/zuul-executor", "-d"]

  zuul-web:
    from: "centos:7"
    roles:
      - ansible-role-zuul-web-container
    expose:
      - 9000
    user: "{{ ZUUL_USER }}"
    command: ["/usr/bin/dumb-init", "scl", "enable", "rh-python35", "zuul-web -d"]

  nodepool-launcher:
    from: "centos:7"
    roles:
      - ansible-role-nodepool-launcher-container
    user: "{{ NODEPOOL_USER }}"
    command: ["/usr/bin/dumb-init", "/usr/bin/nodepool-launcher", "-d"]

registries:
  local.openshift:
    url: https://local.openshift
    pull_from_url: 172.30.1.1:5000
